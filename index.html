<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Fuel Station Management</title>
    
    <!-- CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/toastr@2.1.4/build/toastr.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/apexcharts@3.41.0/dist/apexcharts.css" rel="stylesheet">

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment/min/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.41.0/dist/apexcharts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastr@2.1.4/build/toastr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/autonumeric@4.5.4"></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>

    <style>
        /* Theme Variables */
:root {
    --dark-bg: #1a1a1a;
    --gold-primary: #ffd700;
    --gold-secondary: #daa520;
    --green-primary: #2ecc71;
    --green-secondary: #27ae60;
    --card-bg: #2d2d2d;
    --text-color: #ffffff;
    --shadow-color: rgba(46, 204, 113, 0.2);
    --hover-shadow: rgba(218, 165, 32, 0.3);
    --transition-speed: 0.3s;
}

/* Base Styles */
body { 
    font-family: 'Segoe UI', Arial, sans-serif;
    background: linear-gradient(135deg, var(--dark-bg) 0%, #000000 100%);
    color: var(--text-color);
    margin: 0;
    padding: 20px;
    min-height: 100vh;
    transition: background-color var(--transition-speed) ease;
}

.container {
    max-width: 1200px;
    margin: auto;
    padding: 30px;
    background-color: rgba(45, 45, 45, 0.95);
    border-radius: 15px;
    box-shadow: 0 0 30px rgba(46, 204, 113, 0.15);
    animation: slideInFromTop 0.5s ease-out;
}

/* Section Visibility and Transitions */
.hidden {
    display: none !important;
    opacity: 0;
    transform: translateX(-100%);
}

.fade-in {
    animation: fadeIn 0.5s ease-in forwards;
}

.section-card {
    background: linear-gradient(145deg, rgba(46, 204, 113, 0.1), rgba(218, 165, 32, 0.1));
    border: 1px solid var(--green-primary);
    border-radius: 15px;
    padding: 25px;
    margin: 20px 0;
    transition: all var(--transition-speed) cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.section-card.active {
    opacity: 1;
    transform: translateX(0);
    border-color: var(--gold-primary);
    box-shadow: 0 8px 20px var(--hover-shadow);
}

/* Navigation Buttons */
.btn-custom {
    background: linear-gradient(145deg, var(--green-primary), var(--green-secondary));
    border: none;
    padding: 12px 25px;
    margin: 8px;
    border-radius: 10px;
    color: var(--text-color);
    font-weight: 500;
    letter-spacing: 0.5px;
    transition: all var(--transition-speed) cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.btn-custom:hover, .btn-custom.active {
    background: linear-gradient(145deg, var(--gold-primary), var(--gold-secondary));
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 5px 15px rgba(218, 165, 32, 0.4);
}

/* Form Elements */
.form-control {
    background-color: rgba(0, 0, 0, 0.3);
    border: 2px solid var(--green-primary);
    color: var(--text-color) !important;
    padding: 12px 15px;
    border-radius: 10px;
    transition: all var(--transition-speed) ease;
    font-size: 1rem;
}

.form-control:focus {
    background-color: rgba(0, 0, 0, 0.4);
    border-color: var(--gold-primary);
    box-shadow: 0 0 15px rgba(218, 165, 32, 0.2);
    transform: translateY(-2px);
}

.form-control::placeholder {
    color: rgba(255, 255, 255, 0.6);
}

/* Summary Section */
.total-summary {
    background: linear-gradient(145deg, rgba(46, 204, 113, 0.1), rgba(218, 165, 32, 0.1));
    border: 2px solid var(--gold-primary);
    border-radius: 20px;
    padding: 30px;
    margin-top: 30px;
    box-shadow: 0 5px 20px rgba(218, 165, 32, 0.2);
    animation: pulseGlow 2s infinite;
}

.summary-item {
    background: rgba(0, 0, 0, 0.3);
    padding: 20px;
    border-radius: 12px;
    margin: 10px 0;
    transition: all var(--transition-speed) ease;
    border: 1px solid var(--green-primary);
}

/* Charts Section */
.chart-container {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    padding: 20px;
    margin: 15px 0;
    transition: all var(--transition-speed) ease;
    border: 1px solid var(--green-primary);
}

/* Animations */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateX(-30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes slideInFromTop {
    from {
        transform: translateY(-30px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes pulseGlow {
    0% { box-shadow: 0 5px 15px rgba(218, 165, 32, 0.2); }
    50% { box-shadow: 0 5px 30px rgba(218, 165, 32, 0.4); }
    100% { box-shadow: 0 5px 15px rgba(218, 165, 32, 0.2); }
}

/* Responsive Design */
@media (max-width: 1200px) {
    .container {
        width: 95%;
        padding: 20px;
    }
}

@media (max-width: 768px) {
    body {
        padding: 10px;
    }
    
    .container {
        padding: 15px;
        margin: 0;
        border-radius: 10px;
    }

    .section-card {
        padding: 15px;
    }

    .btn-custom {
        width: 100%;
        margin: 5px 0;
        padding: 10px;
    }

    .row {
        margin: 0;
    }

    .col-md-6, .col-md-4 {
        padding: 5px;
    }

    .chart-container {
        height: 300px;
        margin: 10px 0;
    }
}

@media (max-width: 480px) {
    h2 { font-size: 1.5rem; }
    h3 { font-size: 1.3rem; }
    h4 { font-size: 1.1rem; }
    
    .form-control {
        font-size: 14px;
        padding: 8px 12px;
    }
    
    .summary-item {
        padding: 12px;
    }
}

/* Print Styles */
@media print {
    body {
        background: white;
        color: black;
    }

    .container {
        box-shadow: none;
        padding: 0;
    }

    .btn-custom,
    .action-buttons {
        display: none;
    }

    .section-card,
    .summary-item {
        break-inside: avoid;
        border: 1px solid #ccc;
    }
    
    .chart-container {
        page-break-inside: avoid;
    }
}
    </style>
</head>
<body>
    <div class="container animate__animated animate__fadeIn">
        <h2 class="text-center mb-4">
            <i class="fas fa-gas-pump text-success"></i> 
            Fuel Station Shift Log
        </h2>
        
        <!-- Date Selection -->
        <div class="date-selector mb-4">
            <input type="date" id="shiftDate" class="form-control" value="">
        </div>

        <!-- Navigation Buttons -->
        <div class="d-flex justify-content-center mb-4">
            <button class="btn btn-custom" onclick="showSection('petrol')">
                <i class="fas fa-gas-pump"></i> Petrol
            </button>
            <button class="btn btn-custom" onclick="showSection('diesel')">
                <i class="fas fa-truck"></i> Diesel
            </button>
        </div>

        <!-- Petrol Section -->
        <div id="petrolSection" class="section-card hidden fade-in">
            <h3><i class="fas fa-gas-pump"></i> Petrol Section</h3>
            <button class="btn btn-custom" onclick="setPrice('petrol')">
                <i class="fas fa-rupee-sign"></i> Set Petrol Price
            </button>
            <p id="petrolPriceDisplay" class="mt-3"></p>
            
            <!-- Nozzle 1 -->
            <div class="nozzle-card mt-4">
                <h4><i class="fas fa-gas-pump"></i> Nozzle 1</h4>
                <div class="row">
                    <div class="col-md-6">
                        <label>Opening Reading (8 AM):</label>
                        <input type="number" id="petrolStart1" class="form-control reading-input" 
                               data-type="petrol" data-nozzle="1" placeholder="Enter start reading">
                    </div>
                    <div class="col-md-6">
                        <label>Closing Reading (8 AM Next Day):</label>
                        <input type="number" id="petrolEnd1" class="form-control reading-input"
                               data-type="petrol" data-nozzle="1" placeholder="Enter end reading">
                    </div>
                </div>
            </div>
            
            <!-- Nozzle 2 -->
            <div class="nozzle-card mt-4">
                <h4><i class="fas fa-gas-pump"></i> Nozzle 2</h4>
                <div class="row">
                    <div class="col-md-6">
                        <label>Opening Reading (8 AM):</label>
                        <input type="number" id="petrolStart2" class="form-control reading-input"
                               data-type="petrol" data-nozzle="2" placeholder="Enter start reading">
                    </div>
                    <div class="col-md-6">
                        <label>Closing Reading (8 AM Next Day):</label>
                        <input type="number" id="petrolEnd2" class="form-control reading-input"
                               data-type="petrol" data-nozzle="2" placeholder="Enter end reading">
                    </div>
                </div>
            </div>
            
            <button class="btn btn-custom mt-4" onclick="calculateTotal('petrol')">
                <i class="fas fa-calculator"></i> Calculate Total Sales
            </button>
            <div id="petrolResult" class="result-display"></div>
        </div>

        <!-- Diesel Section -->
        <div id="dieselSection" class="section-card hidden fade-in">
            <h3><i class="fas fa-truck"></i> Diesel Section</h3>
            <button class="btn btn-custom" onclick="setPrice('diesel')">
                <i class="fas fa-rupee-sign"></i> Set Diesel Price
            </button>
            <p id="dieselPriceDisplay" class="mt-3"></p>
            
            <!-- Nozzle 1 -->
            <div class="nozzle-card mt-4">
                <h4><i class="fas fa-truck"></i> Nozzle 1</h4>
                <div class="row">
                    <div class="col-md-6">
                        <label>Opening Reading (8 AM):</label>
                        <input type="number" id="dieselStart1" class="form-control reading-input"
                               data-type="diesel" data-nozzle="1" placeholder="Enter start reading">
                    </div>
                    <div class="col-md-6">
                        <label>Closing Reading (8 AM Next Day):</label>
                        <input type="number" id="dieselEnd1" class="form-control reading-input"
                               data-type="diesel" data-nozzle="1" placeholder="Enter end reading">
                    </div>
                </div>
            </div>
            
            <!-- Nozzle 2 -->
            <div class="nozzle-card mt-4">
                <h4><i class="fas fa-truck"></i> Nozzle 2</h4>
                <div class="row">
                    <div class="col-md-6">
                        <label>Opening Reading (8 AM):</label>
                        <input type="number" id="dieselStart2" class="form-control reading-input"
                               data-type="diesel" data-nozzle="2" placeholder="Enter start reading">
                    </div>
                    <div class="col-md-6">
                        <label>Closing Reading (8 AM Next Day):</label>
                        <input type="number" id="dieselEnd2" class="form-control reading-input"
                               data-type="diesel" data-nozzle="2" placeholder="Enter end reading">
                    </div>
                </div>
            </div>
            
            <button class="btn btn-custom mt-4" onclick="calculateTotal('diesel')">
                <i class="fas fa-calculator"></i> Calculate Total Sales
            </button>
            <div id="dieselResult" class="result-display"></div>
        </div>

        <!-- Total Summary Section -->
        <div class="total-summary animate__animated animate__fadeIn">
            <h3 class="text-center"><i class="fas fa-chart-bar"></i> Daily Summary</h3>
            <div class="row">
                <div class="col-md-4">
                    <div class="summary-item">
                        <h5>Petrol Sales</h5>
                        <p id="totalPetrolSummary">₹0.00</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="summary-item">
                        <h5>Diesel Sales</h5>
                        <p id="totalDieselSummary">₹0.00</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="summary-item">
                        <h5>Grand Total</h5>
                        <p id="grandTotalSummary">₹0.00</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="chart-container">
                    <div id="salesChart"></div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="chart-container">
                    <div id="volumeChart"></div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons mt-4 text-center">
            <button class="btn btn-custom" onclick="generateReport()">
                <i class="fas fa-file-excel"></i> Generate Excel Report
            </button>
            <button class="btn btn-custom" onclick="clearData()">
                <i class="fas fa-trash"></i> Clear Data
            </button>
        </div>
    </div>

    <!-- Load JavaScript -->
    <script>// Initialize global variables
        let salesChart, volumeChart;
        
        // Document Ready Handler
        document.addEventListener('DOMContentLoaded', () => {
            // Set today's date
            document.getElementById('shiftDate').valueAsDate = new Date();
            
            // Initialize charts
            initializeCharts();
            
            // Configure toastr notifications
            toastr.options = {
                closeButton: true,
                progressBar: true,
                positionClass: "toast-bottom-right",
                timeOut: 3000
            };
        
            // Load saved data
            loadSavedData();
            
            // Show initial section
            showSection('petrol');
        });
        
        // Section Navigation
        function showSection(type) {
            const petrolSection = document.getElementById('petrolSection');
            const dieselSection = document.getElementById('dieselSection');
            const petrolBtn = document.querySelector('button[onclick="showSection(\'petrol\')"]');
            const dieselBtn = document.querySelector('button[onclick="showSection(\'diesel\')"]');
        
            [petrolSection, dieselSection].forEach(section => {
                section.classList.add('hidden');
                section.classList.remove('active', 'fade-in');
            });
            [petrolBtn, dieselBtn].forEach(btn => btn.classList.remove('active'));
        
            if (type === 'petrol') {
                petrolSection.classList.remove('hidden');
                petrolSection.classList.add('active', 'fade-in');
                petrolBtn.classList.add('active');
            } else {
                dieselSection.classList.remove('hidden');
                dieselSection.classList.add('active', 'fade-in');
                dieselBtn.classList.add('active');
            }
        }
        
        // Price Setting
        function setPrice(type) {
            Swal.fire({
                title: `Set ${_.capitalize(type)} Price`,
                input: 'number',
                inputLabel: `Enter ${type} price per liter`,
                background: '#2d2d2d',
                color: '#ffffff',
                confirmButtonColor: '#2ecc71',
                showCancelButton: true,
                inputValidator: (value) => {
                    if (!value || value <= 0) return 'Please enter a valid price!';
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    localStorage.setItem(`${type}Price`, result.value);
                    updatePriceDisplay(type, result.value);
                    toastr.success(`${_.capitalize(type)} price updated successfully!`);
                }
            });
        }
        
        // Update Price Display
        function updatePriceDisplay(type, price) {
            document.getElementById(`${type}PriceDisplay`).innerHTML = 
                `<div class="alert alert-success">
                    Current ${_.capitalize(type)} Price: ₹${parseFloat(price).toFixed(2)}/liter
                </div>`;
        }
        
        // Calculate Total Sales
        function calculateTotal(type) {
            const price = parseFloat(localStorage.getItem(`${type}Price`)) || 0;
            
            if (!price) {
                Swal.fire({
                    icon: 'error',
                    title: 'Price Not Set',
                    text: `Please set the ${type} price first!`,
                    background: '#2d2d2d',
                    color: '#ffffff'
                });
                return;
            }
            
            const nozzle1Start = getNumericValue(`${type}Start1`);
            const nozzle1End = getNumericValue(`${type}End1`);
            const nozzle2Start = getNumericValue(`${type}Start2`);
            const nozzle2End = getNumericValue(`${type}End2`);
            
            if (!validateReadings(nozzle1Start, nozzle1End, 1) || 
                !validateReadings(nozzle2Start, nozzle2End, 2)) {
                return;
            }
            
            const nozzle1Sold = nozzle1End - nozzle1Start;
            const nozzle2Sold = nozzle2End - nozzle2Start;
            const totalSold = nozzle1Sold + nozzle2Sold;
            const totalAmount = totalSold * price;
            
            const data = {
                price,
                nozzle1: { start: nozzle1Start, end: nozzle1End, sold: nozzle1Sold, amount: nozzle1Sold * price },
                nozzle2: { start: nozzle2Start, end: nozzle2End, sold: nozzle2Sold, amount: nozzle2Sold * price },
                totalSold,
                totalAmount,
                date: document.getElementById('shiftDate').value
            };
            
            updateResults(type, data);
            saveData(type, data);
            updateTotalSummary();
            updateCharts();
        }
        
        // Update Results Display
        function updateResults(type, data) {
            const resultElement = document.getElementById(`${type}Result`);
            resultElement.innerHTML = `
                <div class="text-center animate__animated animate__fadeIn">
                    <h4 class="mb-4">Sales Summary</h4>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="summary-item">
                                <h5>Nozzle 1</h5>
                                <p>Sold: ${data.nozzle1.sold.toFixed(2)} liters</p>
                                <p>Amount: ₹${data.nozzle1.amount.toLocaleString('en-IN', {maximumFractionDigits: 2})}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="summary-item">
                                <h5>Nozzle 2</h5>
                                <p>Sold: ${data.nozzle2.sold.toFixed(2)} liters</p>
                                <p>Amount: ₹${data.nozzle2.amount.toLocaleString('en-IN', {maximumFractionDigits: 2})}</p>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 pt-3 border-top">
                        <h4>Total Sales</h4>
                        <p>Total ${_.capitalize(type)} Sold: ${data.totalSold.toFixed(2)} liters</p>
                        <p>Rate per liter: ₹${data.price}</p>
                        <h3>Total Amount: ₹${data.totalAmount.toLocaleString('en-IN', {maximumFractionDigits: 2})}</h3>
                    </div>
                </div>
            `;
        }
        
        // Charts Initialization
        function initializeCharts() {
    const commonOptions = {
        chart: {
            height: 350,
            background: 'transparent',
            foreColor: '#ffffff',
            animations: {
                enabled: true,
                easing: 'easeinout',
                speed: 800
            },
            toolbar: {
                show: false
            }
        },
        theme: {
            mode: 'dark'
        },
        responsive: [{
            breakpoint: 480,
            options: {
                chart: {
                    height: 280
                },
                plotOptions: {
                    radialBar: {
                        dataLabels: {
                            name: {
                                fontSize: '16px'
                            },
                            value: {
                                fontSize: '12px'
                            },
                            total: {
                                fontSize: '12px'
                            }
                        }
                    }
                }
            }
        }]
    };

    const salesOptions = {
        ...commonOptions,
        series: [{
            name: 'Sales Amount',
            data: [0, 0, 0, 0]
        }],
        chart: {
            ...commonOptions.chart,
            type: 'bar'
        },
        plotOptions: {
            bar: {
                horizontal: false,
                columnWidth: '55%',
                borderRadius: 8,
                distributed: true
            }
        },
        colors: ['#2ecc71', '#27ae60', '#3498db', '#2980b9'],
        dataLabels: {
            enabled: true,
            formatter: function(value) {
                return '₹' + parseFloat(value).toLocaleString('en-IN');
            },
            style: {
                colors: ['#ffffff'],
                fontSize: '12px'
            }
        },
        xaxis: {
            categories: ['Petrol N1', 'Petrol N2', 'Diesel N1', 'Diesel N2'],
            labels: {
                style: {
                    fontSize: '12px',
                    colors: ['#ffffff']
                }
            }
        },
        yaxis: {
            labels: {
                formatter: function(value) {
                    return '₹' + parseFloat(value).toLocaleString('en-IN');
                },
                style: {
                    colors: ['#ffffff']
                }
            }
        }
    };

    const volumeOptions = {
        ...commonOptions,
        series: [0, 0, 0, 0],
        chart: {
            ...commonOptions.chart,
            type: 'radialBar'
        },
        plotOptions: {
            radialBar: {
                hollow: {
                    margin: 15,
                    size: '40%'
                },
                track: {
                    background: 'rgba(255,255,255,0.1)'
                },
                dataLabels: {
                    name: {
                        show: true,
                        fontSize: '18px',
                        fontWeight: 600,
                        color: '#ffffff'
                    },
                    value: {
                        show: true,
                        fontSize: '14px',
                        fontWeight: 400,
                        color: '#ffffff',
                        formatter: function(value) {
                            return parseFloat(value).toFixed(1) + ' L';
                        }
                    },
                    total: {
                        show: true,
                        label: 'Total Volume',
                        fontSize: '16px',
                        color: '#ffffff',
                        formatter: function(w) {
                            const total = w.globals.seriesTotals.reduce((a, b) => a + b, 0);
                            return parseFloat(total).toFixed(1) + ' L';
                        }
                    }
                }
            }
        },
        labels: ['Petrol N1', 'Petrol N2', 'Diesel N1', 'Diesel N2'],
        colors: ['#2ecc71', '#27ae60', '#3498db', '#2980b9']
    };

    salesChart = new ApexCharts(document.querySelector("#salesChart"), salesOptions);
    volumeChart = new ApexCharts(document.querySelector("#volumeChart"), volumeOptions);
    
    salesChart.render();
    volumeChart.render();
}
        
        // Update Charts
        function updateCharts() {
            const petrolData = JSON.parse(localStorage.getItem('petrolData') || '{"nozzle1":{"sold":0,"amount":0},"nozzle2":{"sold":0,"amount":0}}');
            const dieselData = JSON.parse(localStorage.getItem('dieselData') || '{"nozzle1":{"sold":0,"amount":0},"nozzle2":{"sold":0,"amount":0}}');
        
            const salesData = [{
                name: 'Sales Amount',
                data: [
                    petrolData.nozzle1?.amount || 0,
                    petrolData.nozzle2?.amount || 0,
                    dieselData.nozzle1?.amount || 0,
                    dieselData.nozzle2?.amount || 0
                ]
            }];
        
            const volumeData = [
                petrolData.nozzle1?.sold || 0,
                petrolData.nozzle2?.sold || 0,
                dieselData.nozzle1?.sold || 0,
                dieselData.nozzle2?.sold || 0
            ];
        
            salesChart.updateSeries(salesData);
            volumeChart.updateSeries(volumeData);
        }
        
        // Generate Excel Report
        function generateReport() {
    const date = document.getElementById('shiftDate').value;
    const petrolData = JSON.parse(localStorage.getItem('petrolData') || '{}');
    const dieselData = JSON.parse(localStorage.getItem('dieselData') || '{}');
    
    // Enhanced Excel Styles
    const styles = {
        title: {
            font: { bold: true, sz: 16, color: { rgb: "FFFFFF" } },
            fill: { fgColor: { rgb: "2ECC71" } },
            alignment: { horizontal: "center", vertical: "center", wrapText: true },
            border: {
                top: { style: "medium", color: { rgb: "000000" } },
                bottom: { style: "medium", color: { rgb: "000000" } },
                left: { style: "medium", color: { rgb: "000000" } },
                right: { style: "medium", color: { rgb: "000000" } }
            }
        },
        header: {
            font: { bold: true, sz: 12, color: { rgb: "000000" } },
            fill: { fgColor: { rgb: "E8F5E9" } },
            alignment: { horizontal: "center", vertical: "center" },
            border: {
                top: { style: "thin", color: { rgb: "000000" } },
                bottom: { style: "thin", color: { rgb: "000000" } },
                left: { style: "thin", color: { rgb: "000000" } },
                right: { style: "thin", color: { rgb: "000000" } }
            }
        },
        cell: {
            alignment: { horizontal: "center", vertical: "center" },
            border: {
                top: { style: "thin", color: { rgb: "000000" } },
                bottom: { style: "thin", color: { rgb: "000000" } },
                left: { style: "thin", color: { rgb: "000000" } },
                right: { style: "thin", color: { rgb: "000000" } }
            }
        },
        amount: {
            font: { bold: true, sz: 12, color: { rgb: "006400" } }, // Dark green
            alignment: { horizontal: "right", vertical: "center" },
            border: {
                top: { style: "thin", color: { rgb: "000000" } },
                bottom: { style: "thin", color: { rgb: "000000" } },
                left: { style: "thin", color: { rgb: "000000" } },
                right: { style: "thin", color: { rgb: "000000" } }
            }
        },
        petrolTotal: {
            font: { bold: true, sz: 12, color: { rgb: "FF0000" } }, // Red
            fill: { fgColor: { rgb: "FFE6E6" } }, // Light red
            alignment: { horizontal: "right", vertical: "center" },
            border: {
                top: { style: "double", color: { rgb: "000000" } },
                bottom: { style: "double", color: { rgb: "000000" } },
                left: { style: "thin", color: { rgb: "000000" } },
                right: { style: "thin", color: { rgb: "000000" } }
            }
        },
        dieselTotal: {
            font: { bold: true, sz: 12, color: { rgb: "0000FF" } }, // Blue
            fill: { fgColor: { rgb: "E6E6FF" } }, // Light blue
            alignment: { horizontal: "right", vertical: "center" },
            border: {
                top: { style: "double", color: { rgb: "000000" } },
                bottom: { style: "double", color: { rgb: "000000" } },
                left: { style: "thin", color: { rgb: "000000" } },
                right: { style: "thin", color: { rgb: "000000" } }
            }
        },
        grandTotal: {
            font: { bold: true, sz: 14, color: { rgb: "800080" } }, // Purple
            fill: { fgColor: { rgb: "F0E6FF" } }, // Light purple
            alignment: { horizontal: "right", vertical: "center" },
            border: {
                top: { style: "double", color: { rgb: "000000" } },
                bottom: { style: "double", color: { rgb: "000000" } },
                left: { style: "thin", color: { rgb: "000000" } },
                right: { style: "thin", color: { rgb: "000000" } }
            }
        }
    };

    // Calculate volumes
    const petrolVolume = ((petrolData.nozzle1?.end || 0) - (petrolData.nozzle1?.start || 0)) + 
                        ((petrolData.nozzle2?.end || 0) - (petrolData.nozzle2?.start || 0));
    const dieselVolume = ((dieselData.nozzle1?.end || 0) - (dieselData.nozzle1?.start || 0)) + 
                        ((dieselData.nozzle2?.end || 0) - (dieselData.nozzle2?.start || 0));

    // Format numbers
    const formatNumber = (num) => Number(num).toLocaleString('en-IN', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    });

    const reportData = [
        // Title and Date
        [{ v: 'FUEL STATION DAILY SALES REPORT', t: 's', s: styles.title }, '', '', '', ''],
        [{ v: 'Date:', t: 's', s: styles.header }, { v: date, t: 's', s: styles.cell }, '', 
         { v: 'Employee:', t: 's', s: styles.header }, { v: 'KTSWamy', t: 's', s: styles.cell }],
        ['', '', '', '', ''],

        // Petrol Section
        [{ v: 'PETROL SALES SUMMARY', t: 's', s: styles.header }, '', '', '', ''],
        [{ v: 'Nozzle', t: 's', s: styles.header }, 
         { v: 'Opening Reading', t: 's', s: styles.header },
         { v: 'Closing Reading', t: 's', s: styles.header },
         { v: 'Volume (L)', t: 's', s: styles.header },
         { v: 'Amount (₹)', t: 's', s: styles.header }],
        
        // Petrol Nozzle 1
        [{ v: 'Nozzle 1', t: 's', s: styles.cell },
         { v: petrolData.nozzle1?.start || 0, t: 'n', s: styles.cell },
         { v: petrolData.nozzle1?.end || 0, t: 'n', s: styles.cell },
         { v: (petrolData.nozzle1?.end || 0) - (petrolData.nozzle1?.start || 0), t: 'n', s: styles.cell },
         { v: formatNumber(petrolData.nozzle1?.amount || 0), t: 's', s: styles.amount }],

        // Petrol Nozzle 2
        [{ v: 'Nozzle 2', t: 's', s: styles.cell },
         { v: petrolData.nozzle2?.start || 0, t: 'n', s: styles.cell },
         { v: petrolData.nozzle2?.end || 0, t: 'n', s: styles.cell },
         { v: (petrolData.nozzle2?.end || 0) - (petrolData.nozzle2?.start || 0), t: 'n', s: styles.cell },
         { v: formatNumber(petrolData.nozzle2?.amount || 0), t: 's', s: styles.amount }],

        // Petrol Total
        [{ v: 'Total Petrol:', t: 's', s: styles.petrolTotal }, 
         { v: '', t: 's', s: styles.petrolTotal },
         { v: '', t: 's', s: styles.petrolTotal },
         { v: petrolVolume, t: 'n', s: styles.petrolTotal },
         { v: formatNumber(petrolData.totalAmount || 0), t: 's', s: styles.petrolTotal }],
        
        ['', '', '', '', ''],

        // Diesel Section
        [{ v: 'DIESEL SALES SUMMARY', t: 's', s: styles.header }, '', '', '', ''],
        [{ v: 'Nozzle', t: 's', s: styles.header },
         { v: 'Opening Reading', t: 's', s: styles.header },
         { v: 'Closing Reading', t: 's', s: styles.header },
         { v: 'Volume (L)', t: 's', s: styles.header },
         { v: 'Amount (₹)', t: 's', s: styles.header }],

        // Diesel Nozzle 1
        [{ v: 'Nozzle 1', t: 's', s: styles.cell },
         { v: dieselData.nozzle1?.start || 0, t: 'n', s: styles.cell },
         { v: dieselData.nozzle1?.end || 0, t: 'n', s: styles.cell },
         { v: (dieselData.nozzle1?.end || 0) - (dieselData.nozzle1?.start || 0), t: 'n', s: styles.cell },
         { v: formatNumber(dieselData.nozzle1?.amount || 0), t: 's', s: styles.amount }],

        // Diesel Nozzle 2
        [{ v: 'Nozzle 2', t: 's', s: styles.cell },
         { v: dieselData.nozzle2?.start || 0, t: 'n', s: styles.cell },
         { v: dieselData.nozzle2?.end || 0, t: 'n', s: styles.cell },
         { v: (dieselData.nozzle2?.end || 0) - (dieselData.nozzle2?.start || 0), t: 'n', s: styles.cell },
         { v: formatNumber(dieselData.nozzle2?.amount || 0), t: 's', s: styles.amount }],

        // Diesel Total  
        [{ v: 'Total Diesel:', t: 's', s: styles.dieselTotal },
         { v: '', t: 's', s: styles.dieselTotal },
         { v: '', t: 's', s: styles.dieselTotal },
         { v: dieselVolume, t: 'n', s: styles.dieselTotal },
         { v: formatNumber(dieselData.totalAmount || 0), t: 's', s: styles.dieselTotal }],

        ['', '', '', '', ''],

        // Final Summary
        [{ v: 'FINAL SUMMARY', t: 's', s: styles.title }, '', '', '', ''],
        [{ v: 'Category', t: 's', s: styles.header },
         { v: 'Volume (L)', t: 's', s: styles.header },
         { v: 'Rate/L (₹)', t: 's', s: styles.header },
         { v: 'Amount (₹)', t: 's', s: styles.header }],

        // Summary Totals
        [{ v: 'Total Petrol', t: 's', s: styles.cell },
         { v: petrolVolume, t: 'n', s: styles.cell },
         { v: petrolData.price || 0, t: 'n', s: styles.cell },
         { v: formatNumber(petrolData.totalAmount || 0), t: 's', s: styles.petrolTotal }],
        [{ v: 'Total Diesel', t: 's', s: styles.cell },
         { v: dieselVolume, t: 'n', s: styles.cell },
         { v: dieselData.price || 0, t: 'n', s: styles.cell },
         { v: formatNumber(dieselData.totalAmount || 0), t: 's', s: styles.dieselTotal }],

        // Grand Total
        [{ v: 'Grand Total:', t: 's', s: styles.grandTotal },
         { v: petrolVolume + dieselVolume, t: 'n', s: styles.grandTotal },
         { v: '', t: 's', s: styles.grandTotal },
         { v: formatNumber((petrolData.totalAmount || 0) + (dieselData.totalAmount || 0)), t: 's', s: styles.grandTotal }],

        ['', '', '', '', ''],

        // Footer
        [{ v: 'Generated On:', t: 's', s: styles.cell }, 
         { v: new Date().toLocaleString(), t: 's', s: styles.cell },
         { v: '', t: 's', s: styles.cell },
         { v: 'Signature:', t: 's', s: styles.cell },
         { v: '_____________', t: 's', s: styles.cell }]
    ];

    try {
        // Create worksheet
        const ws = XLSX.utils.aoa_to_sheet(reportData);

        // Define merged cells
        ws['!merges'] = [
            { s: { r: 0, c: 0 }, e: { r: 0, c: 4 } },  // Title
            { s: { r: 3, c: 0 }, e: { r: 3, c: 4 } },  // Petrol Header
            { s: { r: 10, c: 0 }, e: { r: 10, c: 4 } }, // Diesel Header
            { s: { r: 17, c: 0 }, e: { r: 17, c: 4 } }  // Final Summary Header
        ];

        // Set column widths
        ws['!cols'] = [
            { wch: 20 }, // Column A
            { wch: 18 }, // Column B
            { wch: 18 }, // Column C
            { wch: 15 }, // Column D
            { wch: 18 }  // Column E
        ];

        // Create workbook
        const wb = XLSX.utils.book_new();
        wb.Props = {
            Title: "Fuel Station Sales Report",
            Subject: "Daily Sales Summary",
            Author: "KTSWamy",
            CreatedDate: new Date(),
            Company: "KTSWamy Fuel Station"
        };
        
        // Add worksheet to workbook
        XLSX.utils.book_append_sheet(wb, ws, "Sales Report");

        // Generate filename and save
        const formattedDate = date.replace(/-/g, '');
        const fileName = `FuelStation_Report_${formattedDate}_KTSWamy.xlsx`;
        XLSX.writeFile(wb, fileName);

        // Show success message
        Swal.fire({
            icon: 'success',
            title: 'Report Generated Successfully!',
            html: `
                <div class="report-details">
                    <p><i class="fas fa-file-excel text-success"></i> <strong>${fileName}</strong></p>
                    <p><i class="fas fa-user"></i> Employee: <strong>KTSWamy</strong></p>
                    <p><i class="fas fa-calendar"></i> Date: <strong>${date}</strong></p>
                    <p><i class="fas fa-clock"></i> Time: <strong>${new Date().toLocaleTimeString()}</strong></p>
                </div>
            `,
            confirmButtonColor: '#2ecc71'
        });
    } catch (error) {
        console.error('Error generating report:', error);
        Swal.fire({
            icon: 'error',
            title: 'Error',
            text: 'Failed to generate report. Please try again.',
            confirmButtonColor: '#e74c3c'
        });
    }
}
        
        // Helper Functions
        function getNumericValue(elementId) {
            return parseFloat(document.getElementById(elementId).value) || 0;
        }
        
        function validateReadings(start, end, nozzleNum) {
            if (end < start) {
                toastr.error(`Closing reading cannot be less than opening reading for Nozzle ${nozzleNum}`);
                return false;
            }
            return true;
        }
        
        function saveData(type, data) {
            localStorage.setItem(type + 'Data', JSON.stringify(data));
            toastr.success(`${_.capitalize(type)} data saved successfully!`);
        }
        
        function loadSavedData() {
            ['petrol', 'diesel'].forEach(type => {
                const price = localStorage.getItem(`${type}Price`);
                const data = JSON.parse(localStorage.getItem(`${type}Data`) || '{}');
                
                if (price) {
                    updatePriceDisplay(type, price);
                }
                
                if (data.nozzle1) {
                    document.getElementById(`${type}Start1`).value = data.nozzle1.start;
                    document.getElementById(`${type}End1`).value = data.nozzle1.end;
                }
                
                if (data.nozzle2) {
                    document.getElementById(`${type}Start2`).value = data.nozzle2.start;
                    document.getElementById(`${type}End2`).value = data.nozzle2.end;
                }
            });
            
            updateTotalSummary();
            updateCharts();
        }
        
        function clearData() {
            Swal.fire({
                title: 'Are you sure?',
                text: "This will clear all saved data!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#2ecc71',
                cancelButtonColor: '#e74c3c',
                confirmButtonText: 'Yes, clear it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    localStorage.clear();
                    resetInputs();
                    updateTotalSummary();
                    updateCharts();
                    toastr.success('All data has been cleared!');
                }
            });
        }
        
        function resetInputs() {
            document.querySelectorAll('input[type="number"]').forEach(input => {
                input.value = '';
            });
            document.querySelectorAll('.result-display').forEach(div => {
                div.innerHTML = '';
            });
            document.querySelectorAll('#petrolPriceDisplay, #dieselPriceDisplay').forEach(div => {
                div.innerHTML = '';
            });
        }
        
        function updateTotalSummary() {
            const petrolData = JSON.parse(localStorage.getItem('petrolData') || '{"totalAmount": 0}');
            const dieselData = JSON.parse(localStorage.getItem('dieselData') || '{"totalAmount": 0}');
            
            const petrolTotal = petrolData.totalAmount || 0;
            const dieselTotal = dieselData.totalAmount || 0;
            const grandTotal = petrolTotal + dieselTotal;
            
            document.getElementById('totalPetrolSummary').textContent = 
                `₹${petrolTotal.toLocaleString('en-IN', {maximumFractionDigits: 2})}`;
            document.getElementById('totalDieselSummary').textContent = 
                `₹${dieselTotal.toLocaleString('en-IN', {maximumFractionDigits: 2})}`;
            document.getElementById('grandTotalSummary').textContent = 
                `₹${grandTotal.toLocaleString('en-IN', {maximumFractionDigits: 2})}`;
        }
    </script>
</body>
</html>
